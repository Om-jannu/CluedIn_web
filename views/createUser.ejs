<%- include('templates/header'); %>

    <body class="hold-transition dark-mode sidebar-mini layout-fixed layout-navbar-fixed layout-footer-fixed">
        <div class="wrapper">

            <!-- Preloader
        <div class="preloader flex-column justify-content-center align-items-center">
            <img class="animation__shake" src="dist/img/dbit_logo.png" alt="DBIT" height="100" width="100">
        </div> -->

            <!-- Navbar -->
            <%- include('templates/navbar'); %>
                <!-- /.navbar -->

                <!-- Main Sidebar Container -->
                <%- include('templates/sidebar'); %>

                    <!-- Content Wrapper. Contains page content -->
                    <div class="content-wrapper">
                        <!-- Content Header (Page header) -->
                        <div class="content-header">
                            <div class="container-fluid">
                                <div class="row mb-2">
                                    <div class="col-sm-6">
                                        <h1 class="m-0">Create User</h1>
                                    </div><!-- /.col -->
                                    <div class="col-sm-6">
                                        <ol class="breadcrumb float-sm-right">
                                            <li class="breadcrumb-item"><a href="#">Create User</a></li>
                                            <li class="breadcrumb-item active">DBIT Dashboard</li>
                                        </ol>
                                    </div><!-- /.col -->
                                </div><!-- /.row -->
                            </div><!-- /.container-fluid -->
                        </div>
                        <!-- /.content-header -->





                        <!-- Main content -->
                        <section class="content">
                            <div class="container-fluid">

                                <!-- Nav Tabs inside card header -->

                                <div class="card card-primary card-tabs">
                                    <div class="card-header p-0 pt-1">
                                        <ul class="nav nav-tabs" id="custom-tabs-two-tab" role="tablist">
                                            <!-- <li class="pt-2 px-3">
                                    <h3 class="card-title">Card Title</h3>
                                </li> -->
                                            <li class="nav-item">
                                                <a class="nav-link active" id="custom-tabs-two-home-tab"
                                                    data-toggle="pill" href="#createUser" role="tab"
                                                    aria-controls="custom-tabs-two-home" aria-selected="true">Create</a>
                                            </li>
                                            <li class="nav-item">
                                                <a class="nav-link" id="custom-tabs-two-profile-tab" data-toggle="pill"
                                                    href="#listUser" role="tab" aria-controls="custom-tabs-two-profile"
                                                    aria-selected="false">List
                                                    User</a>
                                            </li>
                                            <li class="nav-item">
                                                <a class="nav-link" id="custom-tabs-two-messages" data-toggle="pill"
                                                    href="#bulk" role="tab" aria-controls="custom-tabs-two-messages"
                                                    aria-selected="false">Bulk</a>
                                            </li>
                                            <!-- <li class="nav-item">
                                    <a class="nav-link" id="custom-tabs-two-settings-tab" data-toggle="pill"
                                        href="#custom-tabs-two-settings" role="tab"
                                        aria-controls="custom-tabs-two-settings" aria-selected="false">Settings</a>
                                </li> -->
                                        </ul>
                                    </div>
                                    <div class="card-body">
                                        <div class="tab-content" id="custom-tabs-two-tabContent">
                                            <div class="tab-pane fade active show" id="createUser" role="tabpanel"
                                                aria-labelledby="custom-tabs-two-home-tab">
                                                <% if(message.length>0){ %>
                                                    <div class="alert alert-success">
                                                        <%= message %>
                                                    </div>
                                                    <% } %>
                                                        <!-- creating form -->
                                                        <form id="quickform" method="post" action="/submitUser">
                                                            <!--action looks for index.html -->
                                                            <div class="card-body">
                                                                <div class="form-group">
                                                                    <label for="fname">First Name</label>
                                                                    <input type="text" class="form-control"
                                                                        id="user_fname" placeholder="Enter first name"
                                                                        name="user_fname" required>
                                                                </div>
                                                                <div class="form-group">
                                                                    <label>Last Name</label>
                                                                    <input type="text" class="form-control"
                                                                        id="user_lname" name="user_lname"
                                                                        placeholder="Enter last name" required></input>
                                                                </div>
                                                                <div class="form-group">
                                                                    <label for="mobile">Mobile Number</label>
                                                                    <input type="number" class="form-control"
                                                                        id="user_mobno"
                                                                        placeholder="Enter mobile number"
                                                                        name="user_mobno" maxlength="10" required>
                                                                </div>
                                                                <div class="form-group">
                                                                    <label for="password">Password</label>
                                                                    <input type="password" class="form-control"
                                                                        id="user_pwd" placeholder="Enter password"
                                                                        name="user_pwd" required>
                                                                </div>

                                                                <!-- Dropdown selection -->
                                                                <div class="row">
                                                                    <div class="col-lg-4">
                                                                        <div class="form-group">
                                                                            <label>Role</label>
                                                                            <select class="form-control "
                                                                                style="width: 15rem;" tabindex="-1"
                                                                                id="slct1" aria-hidden="true"
                                                                                name="user_role"
                                                                                placeholder="select user role"
                                                                                onchange="javascript:populate('slct1','slct2')"
                                                                                required>
                                                                            </select>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-lg-4">
                                                                        <div class="form-group">
                                                                            <label>Department</label>
                                                                            <select class="form-control"
                                                                                style="width: 15rem;" tabindex="-1"
                                                                                id="slct2" aria-hidden="true"
                                                                                name="user_dept"
                                                                                placeholder="select user dept">
                                                                            </select>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-lg-4">
                                                                        <div class="form-group">
                                                                            <label>Gender</label>
                                                                            <select class="form-control "
                                                                                style="width: 15rem;" tabindex="-1"
                                                                                id="slct3" aria-hidden="true"
                                                                                name="user_gender"
                                                                                placeholder="select Gender" required>
                                                                                <option selected="selected" value="1">
                                                                                    Male
                                                                                </option>
                                                                                <option value="2">Female</option>
                                                                                <option value="3">Other</option>
                                                                            </select>

                                                                        </div>
                                                                    </div>

                                                                </div>

                                                                <div class="form-group">
                                                                    <label>Email</label>
                                                                    <input type="email" class="form-control"
                                                                        id="user_email" name="user_email"
                                                                        placeholder="Enter email" style="width: 40%;"
                                                                        required></input>
                                                                </div>

                                                                <div class="form-group">
                                                                    <label>Address</label>
                                                                    <textarea class="form-control" rows="3"
                                                                        name="user_addr"
                                                                        placeholder="Enter address"></textarea>
                                                                </div>
                                                                <div class="form-group">
                                                                    <label>Pincode</label>
                                                                    <input type="number" class="form-control"
                                                                        id="user_pincode" name="user_pincode"
                                                                        placeholder="Enter pin" style="width: 40%;"
                                                                        minlength="6" maxlength="6"></input>
                                                                </div>



                                                            </div>

                                                            <div class="card-footer">
                                                                <button type="submit"
                                                                    class="btn btn-primary">Submit</button>
                                                            </div>
                                                        </form>
                                            </div>

                                            <!-- OM YAHA  DAAL FORM  -->
                                            <div class="tab-pane fade" id="listUser" role="tabpanel"
                                                aria-labelledby="custom-tabs-two-profile-tab">

                                                <!-- inside list notif div  -->
                                                <div class="card">
                                                    <div class="card-header">
                                                        <span id="message"></span>
                                                        <h3 class="card-title">USER Table</h3>
                                                        <div class="card-tools">
                                                            <div class="input-group input-group-sm"
                                                                style="width: 150px;">
                                                                <input type="text" name="table_search"
                                                                    class="form-control float-right"
                                                                    placeholder="Search">
                                                                <div class="input-group-append">
                                                                    <button type="submit" class="btn btn-default">
                                                                        <i class="fas fa-search"></i>
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="card-body table-responsive p-0" style="height: 500px;">
                                                        <table class="table table-head-fixed text-nowrap"
                                                            id="user_table">
                                                            <thead>
                                                                <tr>
                                                                    <th>S.no</th>
                                                                    <th>First Name</th>
                                                                    <th>Last Name</th>
                                                                    <th>Mobile No.</th>
                                                                    <th>Email</th>
                                                                    <th>Gender</th>
                                                                    <th>Role</th>
                                                                    <th>Department</th>
                                                                    <th>Address</th>
                                                                    <th>Pincode</th>
                                                                    <th>Action</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>

                                                            </tbody>
                                                        </table>
                                                    </div>

                                                </div>
                                            </div>


                                            <div class="tab-pane fade" id="bulk" role="tabpanel"
                                                aria-labelledby="custom-tabs-two-messages-tab">

                                                <%- include('templates/bulkUserCreation'); %> 
                                            </div>

                                        </div>
                                    </div>

                                </div>



                                <!-- Main Footer -->
                                <footer class="main-footer">
                                    <strong>Copyright &copy; 2022-2023 <a href="">CluedIn</a>.</strong>
                                    All rights reserved.
                                    <div class="float-right d-none d-sm-inline-block">
                                        <b>Version</b> 1.0.0
                                    </div>
                                </footer>
                            </div>
                            <!-- ./wrapper -->

                            <!-- REQUIRED SCRIPTS -->
                            <!-- jQuery -->
                            <script>
                                function populate(s1, s2) {

                                    // console.log("hello jasmit")
                                    var s1 = document.getElementById(s1);

                                    var s2 = document.getElementById(s2);

                                    s2.innerHTML = "";
                                    if (s1.value == 1 || s1.value == 2 || s1.value == 7 || s1.value == 8 || s1.value == 9 || s1.value == 13) {
                                        var optionArray = ["---------------------|---------------------"];
                                        console.log(optionArray);
                                    }
                                    else if (s1.value == 3) {
                                        var optionArray = ["|", "2|IT", "3|COMPS", "4|EXTC", "5|MECH"];
                                        console.log(optionArray);
                                    }
                                    else if (s1.value == 4 || s1.value == 5 || s1.value == 6 || s1.value == 14) {
                                        var optionArray = ["|", "2|IT", "3|COMPS", "4|EXTC", "5|MECH"];
                                    }
                                    else if (s1.value == 10) {
                                        var optionArray = ["|", "Head|Head", "PR|PR"];
                                    }
                                    else if (s1.value == 11 || s1.value == 12) {
                                        var optionArray = ["|", "CSI|CSI", "ACM|ACM", "IETE|IETE", "Madgear|Madgear", "IEEE|IEEE", "E-Cell|E-Cell", "SIE|SIE", "NSS|NSS", "Domain Maths|Domain Maths", "Physics|Physics"];
                                    }
                                    for (var option in optionArray) {
                                        var pair = optionArray[option].split("|");

                                        var newOption = document.createElement("option");
                                        newOption.value = pair[0];
                                        newOption.innerHTML = pair[1];
                                        s2.options.add(newOption);

                                    }
                                }

                            </script>


                            <!-- ---------------------------------Rendering user Table----------------------------------- -->



                            <script src="plugins/jquery/jquery.min.js"></script>
                            <!-- Bootstrap -->
                            <script src="plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
                            <!-- overlayScrollbars -->
                            <script src="plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js"></script>
                            <!-- AdminLTE App -->
                            <script src="dist/js/adminlte.js"></script>

                            <!-- PAGE PLUGINS -->
                            <!-- jQuery Mapael -->
                            <script src="plugins/jquery-mousewheel/jquery.mousewheel.js"></script>
                            <script src="plugins/raphael/raphael.min.js"></script>
                            <script src="plugins/jquery-mapael/jquery.mapael.min.js"></script>
                            <script src="plugins/jquery-mapael/maps/usa_states.min.js"></script>
                            <!-- ChartJS -->
                            <!-- <script src="plugins/chart.js/Chart.min.js"></script> -->

                            <!-- AdminLTE for demo purposes -->
                            <script src="dist/js/demo.js"></script>
                            <!-- AdminLTE dashboard demo (This is only for demo purposes) -->
                            <!-- <script src="dist/js/pages/dashboard2.js"></script> -->

                            <!--modal-->
                            <div class="modal" id="action_modal" tabindex="-1" aria-labelledby="exampleModalLabel"
                                aria-hidden="true">
                                <div class="modal-dialog">

                                    <div class="modal-content">
                                        <form method="get" action="/updateuser" id="sample_form">

                                            <div class="modal-header" id="dynamic_modal_title">
                                                <h5 class="modal-title" id="exampleModalLabel"></h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                    aria-label="Close"></button>
                                            </div>
                                            <div class="modal-body">

                                                <div class="mb-3">
                                                    <label class="col-form-label">First Name</label>
                                                    <input type="text" class="form-control" name="user_fname"
                                                        id="first_name">
                                                </div>
                                                <div class="mb-3">
                                                    <label class="col-form-label">Last Name</label>
                                                    <input type="text" class="form-control" name="user_lname"
                                                        id="last_name">
                                                </div>
                                                <div class="mb-3">
                                                    <label class="col-form-label">Mobile No.</label>
                                                    <input type="number" class="form-control" name="user_mobno"
                                                        id="mobile_num" max="10">
                                                </div>
                                                <div class="mb-3">
                                                    <label class="col-form-label">Email</label>
                                                    <input type="email" class="form-control" name="user_email"
                                                        id="email">
                                                </div>
                                                <div class="mb-3">
                                                    <label class="col-form-label">Gender</label>
                                                    <select class="form-control " id="gender" aria-hidden="true"
                                                        name="user_gender" placeholder="select Gender" required>
                                                        <option selected="selected" value="1">
                                                            Male
                                                        </option>
                                                        <option value="0">Female</option>
                                                    </select>
                                                </div>
                                                <div class="mb-3">
                                                    <label class="col-form-label">Address</label>
                                                    <textarea class="form-control" id="address"
                                                        name="user_addr"></textarea>
                                                </div>
                                                <div class="mb-3">
                                                    <label class="col-form-label">Pincode</label>
                                                    <input type="number" name="user_pincode" id="pincode">
                                                </div>

                                            </div>
                                            <div class="modal-footer">
                                                <input type="hidden" name="id" id="id">
                                                <input type="hidden" name="action" id="action" value="Add">
                                                <button type="button" class="btn btn-secondary closed"
                                                    data-bs-dismiss="modal">Close</button>
                                                <button type="submit" class="btn btn-primary Update"
                                                    id="action_button">Add</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <!-- ---------------------------------Rendering user Table----------------------------------- -->
                            <script>



                                $(document).ready(function () {

                                    load_data();
                                    function load_data() {
                                        $.ajax({
                                            url: "/listuser",
                                            method: "POST",
                                            data: { action: 'fetch' },
                                            dataType: "JSON",
                                            success: function (data) {
                                                // console.log(data.data[1].user_id);
                                                var html = '';

                                                if (data.data.length > 0) {
                                                    for (var count = 0; count < data.data.length; count++) {
                                                        html += `
                                                <tr>
                                                    <td>`+ (count + 1) + `</td>
                                                    <td>`+ data.data[count].user_fname + `</td>
                                                    <td>`+ data.data[count].user_lname + `</td>
                                                    <td>`+ data.data[count].user_mobno + `</td>
                                                    <td>`+ data.data[count].user_email + `</td>
                                                    <td>`+ data.data[count].user_gender + `</td>
                                                    <td>`+ data.data[count].user_role_id + `</td>
                                                    <td>`+ data.data[count].user_department + `</td>
                                                    <td>`+ data.data[count].user_addr + `</td>
                                                    <td>`+ data.data[count].user_pincode + `</td>
                                                    <td style="border-radius: 5px;"><button class="btn btn-warning btn-sm edit" data-id=`+ data.data[count].user_id + `>edit</button>&nbsp;<button type="button" class="btn btn-danger btn-sm delete" data-id="` + data.data[count].user_id + `">Delete</button></td></td>
                                                </tr>
                            
                                            `;
                                                    }
                                                }

                                                $('tbody').html(html);
                                                // console.log(html);

                                            }
                                        });
                                        $.ajax({
                                            url: "/listuser",
                                            method: "POST",
                                            data: { action: 'fetch_user_role' },
                                            dataType: "JSON",
                                            success: function (data) {
                                                // console.log(data[0]);
                                                var html = '<option>----------Select Role---------</option>';

                                                if (data.length > 0) {
                                                    for (var count = 0; count < data.length; count++) {
                                                        html += `
                                                <option value="`+ data[count].role_id + `">` + data[count].role_name + `</option>
                            
                                            `;
                                                    }
                                                }

                                                $('#slct1').html(html);
                                                // console.log(html);

                                            }
                                        });
                                    }
                                    $('#sample_form').on('submit', function () {
                                        event.preventDefault
                                        $('#action').val('Edit');
                                        console.log("inside sample form");
                                        $.ajax({
                                            url: "/listuser",
                                            method: "POST",
                                            data: $('#sample_form').serialize(),
                                            dataType: "JSON",
                                            beforeSend: function () {
                                                $('#action_button').attr('disabled', 'disable')
                                            },
                                            success: function (data) {
                                                $('#action_button').attr('disabled', false);

                                                $('#message').html('<div class="alert alert-success">' + data.success + '</div');

                                                $('#action_modal').modal('hide');

                                                load_data();

                                                setTimeout(function () {
                                                    $('#message'.html(''))
                                                }, 5000);

                                            }
                                        })
                                    });

                                    $(document).on('click', '.edit', function () {
                                        var id = $(this).data('id');

                                        // console.log(id);
                                        // var mobno = $('mobile_num');

                                        $('#dynamic_modal_title').text('Edit Data');

                                        $('#action').val('Edit');

                                        $('#action_button').text('Edit');

                                        $('#action_modal').modal('show');

                                        $.ajax({
                                            url: "/listuser",
                                            method: "POST",
                                            data: { id: id, action: 'fetch_single' },
                                            dataType: "JSON",
                                            success: function (data) {
                                                console.log(data.user_addr);
                                                $('#first_name').val(data.user_fname);
                                                $('#last_name').val(data.user_lname);
                                                $('#mobile_num').val(data.user_mobno);
                                                $('#email').val(data.user_email);
                                                $('#gender').val(data.user_gender);
                                                $('#address').val(data.user_addr);
                                                $('#pincode').val(data.user_pincode);
                                                $('#id').val(data.user_id);

                                            }
                                        });

                                    });
                                    //delete ajax logic
                                    $(document).on('click', '.delete', function () {

                                        var id = $(this).data('id');

                                        if (confirm("Are you sure you want to delete this data?")) {
                                            console.log("inside if");
                                            $.ajax({
                                                url: "/listuser",
                                                method: "GET",
                                                data: { action: 'delete', id: id },
                                                dataType: "JSON",
                                                success: function (data) {
                                                    $('#message').html('<div class="alert alert-success">' + data.message + '</div>');
                                                    load_data();
                                                    setTimeout(function () {
                                                        $('#message').html('');
                                                    }, 3000);
                                                }
                                            });
                                        }

                                    });

                                    $(document).on('click', '.closed', function () {
                                        $('#action_modal').modal('hide');
                                    })

                                });
                            </script>

    </body>

    </html>